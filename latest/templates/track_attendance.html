{% extends "base.html" %}

{% block title %}Track Attendance{% endblock %}

{% block content %}
<div class="dashboard-header">
    <h1 class="page-title">Track Event Attendance</h1>
    <p>Monitor attendance rates across all your events</p>
</div>

<div class="dashboard-cards">
    <div class="card fade-in">
        <div class="card-icon">
            <i class="fas fa-calendar-check"></i>
        </div>
        <h3>Total Events Tracked</h3>
        <div class="card-value">
            {{ attendance_data | length if attendance_data else 0 }}
        </div>
    </div>
    
    <div class="card fade-in" style="animation-delay: 0.1s;">
        <div class="card-icon">
            <i class="fas fa-user-friends"></i>
        </div>
        <h3>Total Registrations</h3>
        <div class="card-value">
            {{ (attendance_data | sum(attribute='total_registrations')) if attendance_data else 0 }}
        </div>
    </div>
    
    <div class="card fade-in" style="animation-delay: 0.2s;">
        <div class="card-icon">
            <i class="fas fa-user-check"></i>
        </div>
        <h3>Total Attendance</h3>
        <div class="card-value">
            {{ (attendance_data | sum(attribute='attended')) if attendance_data else 0 }}
        </div>
    </div>
    
    <div class="card fade-in" style="animation-delay: 0.3s;">
        <div class="card-icon">
            <i class="fas fa-chart-line"></i>
        </div>
        <h3>Average Attendance Rate</h3>
        <div class="card-value">
            {% if attendance_data and attendance_data | length > 0 %}
                {{ (attendance_data | sum(attribute='attendance_rate') / attendance_data | length) | round(1) }}%
            {% else %}
                0%
            {% endif %}
        </div>
    </div>
</div>

<div class="table-container fade-in" style="animation-delay: 0.4s;">
    <div class="table-header">
        <h3><i class="fas fa-clipboard-list"></i> Event Attendance Details</h3>
    </div>
    
    {% if attendance_data %}
    <table>
        <thead>
            <tr>
                <th>Event Name</th>
                <th>Date</th>
                <th>Total Registrations</th>
                <th>Attended</th>
                <th>No-show</th>
                <th>Attendance Rate</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for event in attendance_data %}
            <tr>
                <td>{{ event.event_name }}</td>
                <td>{{ event.event_date }}</td>
                <td>{{ event.total_registrations }}</td>
                <td>{{ event.attended }}</td>
                <td>{{ event.total_registrations - event.attended }}</td>
                <td>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span>{{ "%.1f" | format(event.attendance_rate | default(0)) }}%</span>
                        <div style="flex-grow: 1; background-color: #e0e0e0; height: 8px; border-radius: 4px; overflow: hidden;">
                            <div style="background-color: {% if event.attendance_rate >= 70 %}#4caf50{% elif event.attendance_rate >= 50 %}#ff9800{% else %}#f44336{% endif %}; 
                                 width: {{ event.attendance_rate | default(0) }}%; height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                </td>
                <td>
                    {% if event.attendance_rate >= 70 %}
                    <span class="status-badge status-completed">Good</span>
                    {% elif event.attendance_rate >= 50 %}
                    <span class="status-badge status-ongoing">Fair</span>
                    {% else %}
                    <span class="status-badge status-cancelled">Poor</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div style="padding: 3rem; text-align: center; color: var(--dark-gray);">
        <i class="fas fa-clipboard-check" style="font-size: 4rem; margin-bottom: 1rem;"></i>
        <h3>No Attendance Data Available</h3>
        <p>Start tracking attendance for your events to see data here.</p>
        <a href="{{ url_for('view_registrations') }}" class="btn btn-primary" style="margin-top: 1rem;">
            <i class="fas fa-user-check"></i> Manage Registrations
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}