<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Dashboard - BloodLink</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style_combined.css') }}">
</head>
<body>
  <div class="layout">
    <aside class="sidebar">
      <div class="brand">ðŸ©¸ BloodLink <small class="muted">Admin Panel</small></div>
      <div class="nav">
        <a href="{{ url_for('dashboard') }}">Dashboard</a>
        <a href="{{ url_for('blood_management') }}">Blood Management</a>
        <a href="{{ url_for('blood_requests') }}">Blood Requests</a>
        <a href="{{ url_for('manage_users') }}">Manage Users</a>
        <a href="{{ url_for('analytics') }}">Analytics & Logs</a>
        <a href="{{ url_for('logout') }}">Logout</a>
      </div>
      <div class="muted small" style="margin-top:16px;">Demo build (in-memory data)</div>
    </aside>

    <main class="main">
      <div class="topbar">
        <h1 class="page-title">Dashboard</h1>
        <div class="muted small">Operational overview (live demo data)</div>
      </div>

      <div class="grid">
        <div class="stat"><h3>Total Inventory (ml)</h3><p>{{ counts.total_inventory_ml }}</p></div>
        <div class="stat"><h3>Low Stock Types</h3><p>{{ counts.low_stock | length }}</p></div>
        <div class="stat"><h3>Pending Requests</h3><p>{{ counts.pending_requests }}</p></div>
        <div class="stat"><h3>Total Requests</h3><p>{{ counts.total_requests }}</p></div>
      </div>

      <div class="card">
        <h3 style="margin-top:0;">Quick Actions</h3>
        <div class="actions">
          <a class="btn" href="{{ url_for('blood_management') }}">Go to Blood Management</a>
          <a class="btn secondary" href="{{ url_for('blood_requests') }}">Manage Blood Requests</a>
          <a class="btn light" href="{{ url_for('analytics') }}">View Analytics & Logs</a>
        </div>
      </div>

      <div class="card">
        <h3 style="margin-top:0;">Low Stock (Below 500ml)</h3>
        {% if counts.low_stock %}
        <table class="table">
          <thead><tr><th>Blood Type</th><th>Quantity (ml)</th><th>Action</th></tr></thead>
          <tbody>
            {% for item in counts.low_stock %}
            <tr>
              <td><b>{{ item.blood_type }}</b></td>
              <td><span class="badge red">{{ item.quantity_ml }}</span></td>
              <td><a class="btn warn" href="{{ url_for('blood_management') }}">Restock / Update</a></td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
          <p class="muted">No low stock items ðŸŽ‰</p>
        {% endif %}
      </div>

      <div class="grid" style="grid-template-columns: 1fr 1fr;">
        <div class="card">
          <h3 style="margin-top:0;">Latest Inventory Actions</h3>
          {% if latest_inventory %}
          <table class="table">
            <thead><tr><th>Action</th><th>ID</th><th>Old</th><th>New</th><th>Time</th></tr></thead>
            <tbody>
              {% for log in latest_inventory %}
              <tr>
                <td><span class="badge blue">{{ log.action }}</span></td>
                <td>{{ log.inventory_id }}</td>
                <td>{{ log.old_quantity }}</td>
                <td>{{ log.new_quantity }}</td>
                <td class="small">{{ log.changed_at }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          {% else %}
          <p class="muted">No inventory actions yet.</p>
          {% endif %}
        </div>

        <div class="card">
          <h3 style="margin-top:0;">Latest Request Actions</h3>
          {% if latest_requests %}
          <table class="table">
            <thead><tr><th>Action</th><th>ID</th><th>Old</th><th>New</th><th>Time</th></tr></thead>
            <tbody>
              {% for log in latest_requests %}
              <tr>
                <td><span class="badge gray">{{ log.action }}</span></td>
                <td>{{ log.request_id }}</td>
                <td>{{ log.old_status }}</td>
                <td>{{ log.new_status }}</td>
                <td class="small">{{ log.changed_at }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          {% else %}
          <p class="muted">No request actions yet.</p>
          {% endif %}
        </div>
      </div>

    </main>
  </div>
</body>
</html>
