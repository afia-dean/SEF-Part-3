<!-- templates/track_attendance.html -->
{% extends "base.html" %}

{% block title %}Track Attendance{% endblock %}

{% block content %}
<div class="dashboard-header">
    <h1 class="page-title">Track Event Attendance</h1>
    <p class="subtitle">Monitor attendance rates across all your events</p>
</div>

<!-- Attendance Summary -->
<div class="dashboard-cards">
    <div class="card fade-in">
        <div class="card-icon">
            <i class="fas fa-calendar-check"></i>
        </div>
        <h3>Total Events Tracked</h3>
        <div class="card-value">{{ attendance_data|length }}</div>
    </div>
    
    <div class="card fade-in delay-1">
        <div class="card-icon">
            <i class="fas fa-user-friends"></i>
        </div>
        <h3>Total Registrations</h3>
        <div class="card-value">{{ attendance_data|sum(attribute='total_registrations') }}</div>
    </div>
    
    <div class="card fade-in delay-2">
        <div class="card-icon">
            <i class="fas fa-user-check"></i>
        </div>
        <h3>Total Attendance</h3>
        <div class="card-value">{{ attendance_data|sum(attribute='attended') }}</div>
    </div>
    
    <div class="card fade-in delay-3">
        <div class="card-icon">
            <i class="fas fa-chart-line"></i>
        </div>
        <h3>Average Attendance Rate</h3>
        <div class="card-value">
            {% if attendance_data %}
                {{ (attendance_data|sum(attribute='attendance_rate') / attendance_data|length)|round(1) }}%
            {% else %}
                0%
            {% endif %}
        </div>
    </div>
</div>

<!-- Attendance Table -->
<div class="table-container fade-in delay-4">
    <div class="table-header">
        <h3><i class="fas fa-clipboard-list"></i> Event Attendance Details</h3>
    </div>
    
    {% if attendance_data %}
    <table>
        <thead>
            <tr>
                <th>Event Name</th>
                <th>Date</th>
                <th>Total Registrations</th>
                <th>Attended</th>
                <th>No-show</th>
                <th>Attendance Rate</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for event in attendance_data %}
            <tr>
                <td>{{ event.event_name }}</td>
                <td>{{ event.event_date }}</td>
                <td>{{ event.total_registrations }}</td>
                <td>{{ event.attended }}</td>
                <td>{{ event.total_registrations - event.attended }}</td>
                <td>
                    <div class="attendance-bar-container">
                        <span>{{ "%.1f"|format(event.attendance_rate) }}%</span>
                        <div class="attendance-bar-bg">
                            <div class="attendance-bar-fill" 
                                 style="width: {{ event.attendance_rate }}%;
                                        background-color: {% if event.attendance_rate >= 70 %}#4caf50{% elif event.attendance_rate >= 50 %}#ff9800{% else %}#f44336{% endif %};">
                            </div>
                        </div>
                    </div>
                </td>
                <td>
                    {% if event.attendance_rate >= 70 %}
                    <span class="status-badge status-completed">Good</span>
                    {% elif event.attendance_rate >= 50 %}
                    <span class="status-badge status-ongoing">Fair</span>
                    {% else %}
                    <span class="status-badge status-cancelled">Poor</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="empty-state">
        <i class="fas fa-clipboard-check empty-icon"></i>
        <h3>No Attendance Data Available</h3>
        <p>Start tracking attendance for your events to see data here.</p>
        <a href="{{ url_for('view_registrations') }}" class="btn btn-primary">
            <i class="fas fa-user-check"></i> Manage Registrations
        </a>
    </div>
    {% endif %}
</div>

<!-- Attendance Tips -->
<div class="card fade-in delay-5">
    <h3><i class="fas fa-lightbulb"></i> Tips for Improving Attendance</h3>
    <div class="tips-list">
        <ul>
            <li>
                <i class="fas fa-bell tip-icon"></i>
                Send reminder notifications 24-48 hours before the event
            </li>
            <li>
                <i class="fas fa-gift tip-icon"></i>
                Offer incentives or certificates for regular donors
            </li>
            <li>
                <i class="fas fa-map-marker-alt tip-icon"></i>
                Choose convenient locations with good accessibility
            </li>
            <li>
                <i class="fas fa-clock tip-icon"></i>
                Schedule events at optimal times (weekends, evenings)
            </li>
            <li>
                <i class="fas fa-comments tip-icon"></i>
                Follow up with no-shows and get feedback
            </li>
        </ul>
    </div>
</div>
{% endblock %}

{% block styles %}
<style>
    .delay-1 {
        animation-delay: 0.1s;
    }
    
    .delay-2 {
        animation-delay: 0.2s;
    }
    
    .delay-3 {
        animation-delay: 0.3s;
    }
    
    .delay-4 {
        animation-delay: 0.4s;
    }
    
    .delay-5 {
        animation-delay: 0.5s;
    }
    
    .attendance-bar-container {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .attendance-bar-bg {
        flex-grow: 1;
        background-color: #e0e0e0;
        height: 8px;
        border-radius: 4px;
    }
    
    .attendance-bar-fill {
        height: 100%;
        border-radius: 4px;
    }
    
    .empty-state {
        padding: 3rem;
        text-align: center;
        color: var(--dark-gray);
    }
    
    .empty-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
        color: var(--primary-red);
    }
    
    .tips-list ul {
        list-style-type: none;
        padding: 0;
    }
    
    .tips-list li {
        margin-bottom: 0.5rem;
        padding-left: 1.5rem;
        position: relative;
    }
    
    .tip-icon {
        position: absolute;
        left: 0;
        color: var(--primary-red);
    }
</style>
{% endblock %}